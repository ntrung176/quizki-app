rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ============================================
    // SHARED KANJI DATA (all authenticated users)
    // ============================================

    // Kanji collection - shared data, any authenticated user can read
    // Only admin should write (enforce via app logic)
    match /kanji/{kanjiId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // Kanji Vocab collection - shared data
    match /kanjiVocab/{vocabId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // Vocab Categories collection - shared data
    match /vocabCategories/{categoryId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // ============================================
    // USER-SPECIFIC DATA (per-user, under artifacts/)
    // ============================================

    // User vocabulary, settings, daily activity, kanji SRS, etc.
    match /artifacts/{appId}/users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Public stats (leaderboard) - anyone authenticated can read, only own data can be written
    match /artifacts/{appId}/public/data/userStats/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
